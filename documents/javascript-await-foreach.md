---
title: "JavaScript: ÂΩì forEach ÈÅá‰∏ä await ÁöÑÂùë"
tags:
  - JavaScript
categories:
  - Tech
date: 2018-06-22 22:49:22
---

### ÂâçË®Ä

ÂΩì JavaScript ËøõÂÖ• ES6+ Êó∂‰ª£ÂêéÔºåÂÆÉÁöÑËØ≠Ê≥ïÁ≥ñÂíåÊÄßËÉΩÁöÑ‰∏çÂá°Ë°®Áé∞ÔºàÁõ∏ÊØî‰∫éÂÖ∂‰ªñÁöÑËÑöÊú¨ËØ≠Ë®ÄÔºâÔºåÈÉΩ‰ΩøÂÆÉÈÄêÊ∏êÁ´ôÁ®≥‰∫ÜËÑöË∑üÔºåÊàê‰∏∫‰∏Ä‰∏™‰∏çÂèØÊõø‰ª£ÁöÑÊµÅË°åËØ≠Ë®Ä„ÄÇ
ÁÑ∂ËÄåÔºå‰∏çÂæó‰∏çÊâøËÆ§ÔºåES6+ ÊØïÁ´üÂ§ßÂ§öËøòÊòØËçâÊ°à„ÄÇ
ËÆ∏Â§öÁöÑÂáΩÊï∞ËÆæËÆ°ÈÉΩÊ≤°ÊúâÊÉ≥Ë±°‰∏≠ÁöÑÈÇ£‰πàÁßëÂ≠¶Ôºå‰πüÂ∏∏Â∏∏‰ºöÂõ†‰∏∫Ê≤°Êúâ‰ªîÁªÜËÄÉÈáèËÄåÂá∫ÂæàÂ§ö new FeatureÔºàbugÔºâ„ÄÇ
Âú®ÊàëÂÜôÊñ∞ÁöÑÈùôÊÄÅÂçöÂÆ¢ÂºïÊìéÊó∂ÔºåÂ∞±ÈÅáÂà∞‰∫ÜÂæàÂ§öÈóÆÈ¢ò„ÄÇ‰ª•‰∏ãËøô‰∏™ÈóÆÈ¢òÊàëÊúÄ‰∏∫ËÆ∞ÂøÜÁäπÊñ∞ÔºåÂÆÉ‰∏çÊòØ bug„ÄÇ‰∏™‰∫∫ËßâÂæóÂÅèÂêëËÆæËÆ°‰∏äÁöÑ‰∏Ä‰∏™Áº∫Èô∑„ÄÇ

### ÊíûÂùë

Âõ†‰∏∫Âú®ÊàëÁöÑ **metaÁîüÊàêÂô®** ‰∏≠ÔºåÊàë‰ΩøÁî®Âà∞‰∫Ü‰∏Ä‰∏™ÈùûÂ∏∏‰ºòÁßÄÁöÑËØ≠‰πâÁºñËØëÊèí‰ª∂ **unified**ÔºåÂÆÉÂèØ‰ª•ËÆ©Êàë‰ª¨ÈùûÂ∏∏Êñπ‰æøÂú∞ËΩ¨Êç¢ËØ≠Ë®ÄËßÑÂàô„ÄÇ
Â∞Ü‰∏ÄÁßçËØ≠Ë®ÄËÆæËÆ°ÂèòÂåñÊàêÂè¶‰∏ÄÁßç„ÄÇÂ¶Ç **markdown** Âèò‰∏∫ **rehype** ÔºàÊàñËÄÖËØ¥ htmlÔºâÊàñÊòØÔºå**txt**Ôºå**LaTeX** Á≠âÁ≠â„ÄÇ
ÂÖ∂‰∏≠Ôºå‰∏∫‰∫Ü‰∏çÈòªÂ°ûÁ∫øÁ®ãÔºå**unified** ÈááÁî® pipe + Promise ÁöÑÊñπÂºèÔºåÂ∞ÜÁºñËØëÂ•ΩÁöÑÊñáÂ≠óÂºÇÊ≠•ËøîÂõû„ÄÇ

Áî±‰∫éÂú®Â§ÑÁêÜÊØè‰∏ÄÁØáÊñáÁ´†ÁöÑÊó∂ÂÄôÔºåÊàëÈÉΩÂøÖÈ°ªÈÅçÂéÜÊØè‰∏Ä‰∏™ .md Êñá‰ª∂„ÄÇÂπ∂‰∏∫‰ªñ‰ª¨‰∏Ä‰∏ÄÁîüÊàêÊñáÁ´† meta ÂêéÊâçËÉΩËøõË°åÊõ¥ÂêéÈù¢ÁöÑÊìç‰Ωú„ÄÇ
ÔºàÂ¶ÇÔºåÁªüËÆ°ÔºåÊéíÂ∫èÔºåÁ≠âÁ≠âÔºâÂõ†Ê≠§Ôºå‰∏∫‰∫ÜÈÅøÂÖçÊàëÁöÑ‰∏ªÁ∫øÁ®ãËøõÂÖ•ÂºÇÊ≠•Ê®°ÂºèÔºåÊàëÂÜ≥ÂÆöÁõ¥Êé•ÂØπ **unified** Êìç‰ΩúËøõË°å `await` Â§ÑÁêÜ„ÄÇ
‰ª£Á†ÅÂ§ßÊ¶ÇÊòØËøôÊ†∑ÁöÑÔºö

```javascript
/* ÈÅçÂéÜÊâÄÊúâ .md Êñá‰ª∂ */
mkDir.forEach(md => {

    /* Ê≠§Â§ÑÁúÅÁï•ÁßÄÁöÑ‰∏ÄÊâãÂ•ΩÊìç‰Ωú */

    const rawHTMLContent = await pipeHTML(rawMarkdownContent);

});
```

ÂΩìÁÑ∂ÔºåÊúÄÂêéËøòÂæóÊääÁúü‰∏™ `main` ÂáΩÊï∞Êîπ‰∏∫ async ‰ª•ÊîØÊè¥ await ÁöÑË∞ÉÁî®„ÄÇ

Âπ∂Áî®Â¶Ç‰∏ãÁöÑÊñπÂºèÂêØÂä® `main` ÂáΩÊï∞Ôºö

```javascript
main().then(() => {process.exit(0);});
```

‰ΩÜÊòØÔºå‰ø°ÂøÉÊª°Êª°Âú∞ÊâßË°å‰πãÂêéÔºåÂèëÁé∞Á≥ªÁªüÊä•ÈîôÔºö

`await should be used in async function`

ËøôÊàëÂ∞±Á∫≥Èó∑‰∫ÜÔºåÊòéÊòé `main` Â∑≤ÁªèÊòØ async ÂáΩÊï∞‰∫ÜÂëÄ„ÄÇÊÉ≥‰∫Ü‰∏Ä‰ºöÂÑøÔºåÂèçÂ∫îËøáÊù• forEach Êú¨Ë¥®ÊòØÂàÜÊ¨°ÊâßË°å„ÄÇ
Ë∞ÉÁî® `md => {}` ÂåøÂêçÂáΩÊï∞„ÄÇËøô‰∏™ÂáΩÊï∞Âπ∂‰∏çÊòØ async ‰∫éÊòØ„ÄÇÂ∞Ü‰∏äÈù¢Á¨¨‰∏ÄË°åÊîπ‰∏∫Ôºö

```javascript
/* ÈÅçÂéÜÊâÄÊúâ .md Êñá‰ª∂ */
mkDir.forEach(async md => {

    /* Ê≠§Â§ÑÁúÅÁï•ÁßÄÁöÑ‰∏§ÊâãÂ•ΩÊìç‰Ωú */

});
```

ËøôÊ¨°‰∏çÊä•Èîô‰∫ÜÔºå‰ΩÜÊòØÔºåÊàëÊÉäËÆ∂Âú∞ÂèëÁé∞ `const rawHTMLContent ...` Ëøô‰∏ÄË°åÂåÖÊã¨‰πãÂêéÁöÑÂ±ÖÁÑ∂ÈÉΩÊ≤°Ë¢´ÊâßË°åÔºÅ

È°∫ÁùÄ‰∏äÊ¨°ÈîôËØØÁöÑÊÄùË∑ØÂàÜÊûê„ÄÇforEach ‰∏≠ÊâÄÊúâÂáΩÊï∞ÈÉΩÊòØ async ‰πüÂ∞±ÊòØËøô‰∏™ forEach Êú¨Ë∫´Â∞±ÂèòÊàê‰∫Ü‰∏Ä‰∏™ÂºÇÊ≠•ÂáΩÊï∞ 2333„ÄÇÁúüÊòØÁÑ∂ÊàëÂì≠Á¨ë‰∏çÂæóÂñµ TAT

‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÊñπÊ≥ï„ÄÇÊúÄÂ•ΩÁöÑÊñπÊ≥ïÔºåÁõ¥Êé•ÊîæÂºÉ forEach ÊîπÁî®ÂÆÉÁöÑÊõø‰ª£Áâ©ÔºàËôΩÁÑ∂‰∏ë‰∫Ü‰∏Ä‰∫õÔºâÔºö

```javascript
for (md of mkDir) {

    /* Ê≠§Â§ÑÁúÅÁï•ÁßÄÁöÑ‰∏§ÊâãÂ•ΩÊìç‰Ωú */

}
```

Ëá≥Ê≠§ÔºåÂùëÂ°´‰∏ä„ÄÇ

### ÂêéËÆ∞

ÂêéÊù•ËøòÊòØ‰∏çÊ≠ªÂøÉü§£ÔºåÂ∞±ÊòØË¶ÅÁî®‰ºòÈõÖÁöÑ forEach ‰∫éÊòØÔºåÂ∞±Ëá™Â∑±Â∞ÅË£Ö‰∏Ä‰∏™Ôºå‰∏ìÈó®Êé•Êî∂ÁÉ´Â±±ËäãÔºö

```javascript
Array.prototype.forEachAwait = async function (fn) {
    for (let i in this) await fn(this[i], i);
}
```

ÊâßË°åÁöÑ‰ª£Á†ÅÊàñËÆ∏ÊòØËøôÊ†∑ÁöÑÔºö

```javascript
/* È¶ñÂÖà‰Ω†ÈúÄË¶Å‰∏Ä‰∏™ÈúÄË¶ÅË¢´Á≠âÂæÖÁöÑÂáΩÊï∞ */
async function getValue() {
    return new Promise(resolve => setTimeout(()=>{
        resolve(Math.random())
    }), 10000);
}

/* ÂÆÉÂèØ‰ª•ËøôÊ†∑Ë¢´ÊâßË°å */
await [1,2,3,4,5].forEachAwait(async v => {
    let a = await getValue();
    console.log(v, a);
});
console.log("done");

/* ËæìÂá∫ÂèØ‰ª•‰∏∫             */
/* 1 0.2001572090840873 */
/* 2 0.9472712652910735 */
/* 3 0.1854800495690847 */
/* 4 0.7421414244802222 */
/* 5 0.0497587313905893 */
/* done                 */

/* ÂΩìÁÑ∂‰Ω†ÂèØ‰ª•Ëøô‰πàÂØπÊØî */
[1,2,3,4,5].forEach(async v => {
    let a = await getValue(); 
    console.log(v, a);
});
console.log("done");

/* ËæìÂá∫ÂèØ‰ª•‰∏∫             */
/* done                 */
/* 1 0.2036789330780133 */
/* 2 0.0226663336755419 */
/* 3 0.0726829453933766 */
/* 4 0.6238320663197987 */
/* 5 0.9275859417197259 */
```

‰ª•‰∏ä
